<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="OpenBeam - Online structural analysis calculators.">
    <meta name="author" content="JosÃ© Luis Blanco Claraco">

    <!--
    <meta property="og:title" content="A Basic HTML5 Template">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.sitepoint.com/a-basic-html5-template/">
    <meta property="og:description" content="A simple HTML5 Template for new projects.">
    <meta property="og:image" content="image.png">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    -->

    <title>OpenBeam online App</title>

    <script type="text/javascript" src="../js-ace-min-noconflict/ace.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/web-ob-solve.js" defer></script>



    <style type="text/css" media="screen">
        #main {
            display: flex;
        }

        #parent {
            width: 500px;
            height: 500px;
            display: inline-block;
            float: left;
            position: relative;
        }

        #editor {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        #canvas {
            flex-grow: 1;
            border: 1px solid #555;
            height: 500px;
        }

        #top-toolbar {
            width: 100%;
            height: 40px;
        }

        #OutputArea {
            width: 500px;
        }
    </style>

    <script>
        // var Module = {
        // onRuntimeInitialized: function() {
        // ...

        function buildStructure() {
            var instance = new Module.AppOpenBeam();

            // save text to textarea
            var s = editor.getValue();

            var ret = instance.LoadStructureDefinition(s);
            var ret2 = instance.Solve();

            var reactions = instance.GetReactionsAsHTML();

            document.getElementById('OutputArea').value = ret + ret2;

            document.getElementById('OutputReactions').innerHTML = reactions;

            // Render GL visualization:

        }
    </script>
</head>

<body>
    <div id="top-toolbar">
        Example files: &nbsp;
        <select id="demoSelect" onchange="loadDemoFile(this.value)"></select>

        &nbsp;&nbsp;

        <button onclick="buildStructure()">Calculate</button>
    </div>

    <div id="main">
        <div id="parent">
            <div id="editor"></div>
        </div>
        <canvas id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>
    </div>


    <div>
        <textarea readonly id="OutputArea" rows="10">(output messages)</textarea>
    </div>
    <div id="OutputReactions">(Reactions)</div>


    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/yaml");
        editor.resize();
    </script>


    <script>
        // Synchronously read a text file from the web server with Ajax
        //
        // The filePath is relative to the web page folder.
        // Example:   myStuff = loadFile("Chuuk_data.txt");
        //
        // You can also pass a full URL, like http://sealevel.info/Chuuk1_data.json, but there
        // might be Access-Control-Allow-Origin issues. I found it works okay in Firefox, Edge,
        // or Opera, and works in IE 11 if the server is configured properly, but in Chrome it only
        // works if the domains exactly match (and note that "xyz.com" & "www.xyz.com" don't match).
        // Otherwise Chrome reports an error:
        //
        //   No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://sealevel.info' is therefore not allowed access.
        //
        // That happens even when "Access-Control-Allow-Origin *" is configured in .htaccess,
        // and even though I verified the headers returned (you can use a header-checker site like
        // http://www.webconfs.com/http-header-check.php to check it). I think it's a Chrome bug.
        function loadFile(filePath) {
            var result = null;
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET", filePath, false);
            xmlhttp.send();
            if (xmlhttp.status == 200) {
                result = xmlhttp.responseText;
            }
            return result;
        }

        // List of examples:
        lstExamples = JSON.parse(loadFile('../examples-structures/demo-list.json'));
        var selectElement = document.getElementById('demoSelect');

        {
            var el = document.createElement("option");
            el.textContent = '';
            el.value = '';
            selectElement.appendChild(el);
        }

        for (var i = 0; i < lstExamples.length; i++) {
            var opt = lstExamples[i];
            var el = document.createElement("option");
            el.textContent = opt;
            el.value = opt;
            selectElement.appendChild(el);
        }

        function loadDemoFile(fil) {
            if (fil != '') {
                f = loadFile('../examples-structures/' + fil);
                editor.setValue(f, -1); // "-1": move cursor to start
            }
        }

    </script>

</body>

</html>